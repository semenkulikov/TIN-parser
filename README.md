# TIN Parser

Парсер для получения данных о председателях компаний по ИНН и названию.

## Настройка API ключей Dadata

Для корректной работы парсера Dadata необходимо получить API ключ:

1. Зарегистрируйтесь на сайте [dadata.ru](https://dadata.ru/)
2. После регистрации перейдите в [личный кабинет](https://dadata.ru/profile/#info)
3. Скопируйте API-ключ (токен)
4. Установите ключ в переменную окружения:

```bash
export DADATA_TOKEN=ваш_токен_dadata
```

### Использование нескольких ключей Dadata

Поскольку Dadata имеет ограничение 10 000 запросов в день на один ключ, парсер поддерживает использование нескольких ключей. Для этого:

1. Создайте несколько аккаунтов на сайте dadata.ru
2. Получите API-ключи для каждого аккаунта
3. Установите их в переменные окружения с индексами:

```bash
export DADATA_TOKEN=первый_токен_dadata
export DADATA_TOKEN_1=второй_токен_dadata
export DADATA_TOKEN_2=третий_токен_dadata
export DADATA_TOKEN_3=четвертый_токен_dadata
```

Парсер будет автоматически переключаться на следующий ключ при превышении лимита запросов.

## Запуск парсера

```bash
python main.py [входной_файл.xlsx] [выходной_файл.csv]
```

По умолчанию используются файлы:
- Входной файл: `test.xlsx`
- Выходной файл: `results.csv`

## Доступные парсеры

- **DadataParser** - основной парсер, использующий комбинированный подход:
  - Автоматически получает ФИО председателя через Dadata API
  - Получает ИНН председателя через сайт Райффайзен банка
  - Поддерживает ротацию API ключей Dadata при достижении лимитов

- **FocusKonturParser** - парсинг с сайта focus.kontur.ru (лимит 100 запросов в день)
- **CheckoParser** - парсинг с сайта checko.ru
- **ZaChestnyiBiznesParser** - парсинг с сайта zachestnyibiznes.ru
- **AuditItParser** - парсинг с сайта audit-it.ru
- **RbcCompaniesParser** - парсинг с сайта companies.rbc.ru

## Процесс поиска ИНН председателя

1. Парсер сначала получает данные о компании по её ИНН через API Dadata
2. Из полученных данных извлекается ФИО руководителя (председателя)
3. Затем производится поиск ИНН руководителя через сайт Райффайзен банка
   - Открывается страница https://reg-raiffeisen.ru/
   - В поле "Вводи ИП или ООО" вводится ФИО председателя
   - Из автоподсказки извлекается ИНН физического лица
   - Используется регулярное выражение для форматирования и валидации ИНН

## Формат входных данных

Входной файл Excel должен содержать следующие колонки:
- **Юридическое название** - название компании
- **ИНН** - ИНН компании

## Формат выходных данных

Выходной CSV-файл будет содержать:
- **Юридическое название** - название компании
- **ИНН** - ИНН компании
- **ФИО Председателя** - ФИО руководителя компании
- **ИНН Председателя** - ИНН руководителя (если удалось получить)
- **Источник** - сайт или API, откуда получены данные
